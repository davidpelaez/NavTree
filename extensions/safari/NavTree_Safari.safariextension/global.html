<!DOCTYPE HTML> 
<script src="jquery162.js" type="text/javascript"></script>
<script src="TabsTable.js" type="text/javascript"></script>
<script src="NavTreeTab.js" type="text/javascript"></script>
<script>  



//Data structure to keep record of the tree and sync with the server
var tabsTable = new TabsTable();

//Event tracking
safari.application.addEventListener("open", tabsTable.openHandler, true); 
safari.application.addEventListener("close", tabsTable.closeHandler, true); 
safari.application.addEventListener("beforeNavigate", tabsTable.navigationHandler, true);  //Record the intention to go somewhere

window.onload = function(){
	console.log("The global page was loaded");        
	//Add all tabs. No duplicated are added because add manages that case. This is for simpler testing. 
	//Navigation happens on reaload but not the events of open, that's why this method is added
	windows = safari.application.browserWindows;
	for(var i=0; i< windows.length;i++){
		for(var j=0;j<windows[i].tabs.length;j++){
			tabsTable.addTab(windows[i].tabs[j]);
			
		}
		
	}
}


</script>
